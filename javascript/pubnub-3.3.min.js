window.JSON&&window.JSON.stringify||function(){function p(c){x.lastIndex=0;return x.test(c)?'"'+c.replace(x,function(c){var d=H[c];return"string"===typeof d?d:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}function q(u,s){var d,j,t,l,o=i,m,e=s[u];e&&("object"===typeof e&&"function"===typeof e.toJSON)&&(e=e.toJSON(u));"function"===typeof h&&(e=h.call(s,u,e));switch(typeof e){case "string":return p(e);case "number":return isFinite(e)?String(e):"null";case "boolean":case "null":return String(e);
case "object":if(!e)return"null";i+=c;m=[];if("[object Array]"===Object.prototype.toString.apply(e)){l=e.length;for(d=0;d<l;d+=1)m[d]=q(d,e)||"null";t=0===m.length?"[]":i?"[\n"+i+m.join(",\n"+i)+"\n"+o+"]":"["+m.join(",")+"]";i=o;return t}if(h&&"object"===typeof h){l=h.length;for(d=0;d<l;d+=1)j=h[d],"string"===typeof j&&(t=q(j,e))&&m.push(p(j)+(i?": ":":")+t)}else for(j in e)Object.hasOwnProperty.call(e,j)&&(t=q(j,e))&&m.push(p(j)+(i?": ":":")+t);t=0===m.length?"{}":i?"{\n"+i+m.join(",\n"+i)+"\n"+
o+"}":"{"+m.join(",")+"}";i=o;return t}}window.JSON||(window.JSON={});"function"!==typeof String.prototype.toJSON&&(String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var x=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i,c,H={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!==typeof JSON.stringify&&(JSON.stringify=function(u,
s,d){var j;c=i="";if(typeof d==="number")for(j=0;j<d;j=j+1)c=c+" ";else typeof d==="string"&&(c=d);if((h=s)&&typeof s!=="function"&&(typeof s!=="object"||typeof s.length!=="number"))throw Error("JSON.stringify");return q("",{"":u})});"function"!==typeof JSON.parse&&(JSON.parse=function(c){return eval("("+c+")")})}();
window.PUBNUB||function(){function p(){return"x"+ ++W+""+ +new Date}function q(){return+new Date}function x(a,b){var f,k=0,c=function(){k+b>q()?(clearTimeout(f),f=setTimeout(c,b)):(k=q(),a())};return c}function i(a){return document.getElementById(a)}function c(a){console.log(a)}function H(a,b){var f=[];h(a.split(/\s+/),function(a){h((b||document).getElementsByTagName(a),function(a){f.push(a)})});return f}function h(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var f=0,c=a.length;f<c;)b.call(a[f],a[f],
f++);else for(f in a)a.hasOwnProperty&&a.hasOwnProperty(f)&&b.call(a[f],f,a[f])}function u(a,b){var f=[];h(a||[],function(a,c){f.push(b(a,c))});return f}function s(a,b){var f=[];h(a||[],function(a){b(a)&&f.push(a)});return f}function d(a,b){return a.replace(X,function(a,c){return b[c]||a})}function j(a,b,c){h(a.split(","),function(a){var e=function(a){a||(a=window.event);c(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())};b.addEventListener?
b.addEventListener(a,e,!1):b.attachEvent?b.attachEvent("on"+a,e):b["on"+a]=e})}function t(){return H("head")[0]}function l(a,b,c){if(c)a.setAttribute(b,c);else return a&&a.getAttribute&&a.getAttribute(b)}function o(a,b){for(var c in b)if(b.hasOwnProperty(c))try{a.style[c]=b[c]+(0<"|width|height|top|left|".indexOf(c)&&"number"==typeof b[c]?"px":"")}catch(e){}}function m(a){return document.createElement(a)}function e(){return I||n()?0:p()}function z(a){return u(encodeURIComponent(a).split(""),function(a){return 0>
"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function w(a){if(I||n()){a:{var b,c,e=function(){if(!j){j=1;clearTimeout(h);try{c=JSON.parse(b.responseText)}catch(a){return E(1)}q(c)}},d=0,j=0,h=setTimeout(function(){E(1)},J),s=a.fail||function(){},q=a.success||function(){},E=function(a){d||(d=1,clearTimeout(h),b&&(b.onerror=b.onload=null,b.abort&&b.abort(),b=null),a&&s())};try{b=n()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest;b.onerror=b.onabort=
function(){E(1)};b.onload=b.onloadend=e;b.timeout=J;var v=a.url.join(O);if(a.data){var e=[],A,v=v+"?";for(A in a.data)e.push(A+"="+a.data[A]);v+=e.join(P)}b.open("GET",v,"undefined"==typeof a.blocking);b.send()}catch(Z){E(0);I=0;a=w(a);break a}a=E}return a}var g=m("script"),v=a.callback,Q=p(),R=0,Y=setTimeout(function(){o(1)},J),u=a.fail||function(){},r=a.success||function(){},o=function(a,b){R||(R=1,a||r(b),g.onerror=null,clearTimeout(Y),setTimeout(function(){a&&u();var b=i(Q),c=b&&b.parentNode;
c&&c.removeChild(b)},G))};window[v]=function(a){o(0,a)};a.blocking||(g[S]=S);g.onerror=function(){o(1)};g.src=a.url.join(O);if(a.data){v=[];g.src+="?";for(key in a.data)v.push(key+"="+a.data[key]);g.src+=v.join(P)}l(g,"id",Q);t().appendChild(g);return o}function K(){PUBNUB.time(q);PUBNUB.time(function(){setTimeout(function(){L||(L=1,h(T,function(a){a[2].subscribe(a[0],a[1])}))},G)})}function n(){if(!U.get)return 0;var a={id:n.id++,send:function(){},abort:function(){a.id={}},open:function(b,c){n[a.id]=
a;U.get(a.id,c)}};return a}window.console||(window.console=window.console||{});console.log||(console.log=(window.opera||{}).postError||function(){});var D,B=window.localStorage;D={get:function(a){try{return B?B.getItem(a):-1==document.cookie.indexOf(a)?null:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null}catch(b){}},set:function(a,b){try{if(B)return B.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};var W=1,X=/{([\w\-]+)}/g,S="async",
O="/",P="&",J=31E4,G=1E3,I=-1==navigator.userAgent.indexOf("MSIE 6"),M,N=Math.floor(9*Math.random())+1;M=function(a){return 0<a.indexOf("pubsub")&&a.replace("pubsub","ps"+(10>++N?N:N=1))||a};var y={list:{},unbind:function(a){y.list[a]=[]},bind:function(a,b){(y.list[a]=y.list[a]||[]).push(b)},fire:function(a,b){h(y.list[a]||[],function(a){a(b)})}},r=i("pubnub")||{},L=0,T=[],V=function(a){var b={},f=a.publish_key||"",k=a.subscribe_key||"",r=a.ssl?"s":"",n=a.uuid||D.get(k+"uuid")||"",C="http"+r+"://"+
(a.origin||"pubsub.pubnub.com"),B=function(){},F={history:function(a,b){var b=a.callback||b,A=a.limit||100,d=a.channel,g=e();if(!d)return c("Missing Channel");if(!b)return c("Missing Callback");if(!k)return c("Missing Subscribe Key");w({success:function(a){b(a)},fail:function(a){c(a)},callback:g,url:[C,"history",k,z(d),g,A]})},detailedHistory:function(a,b){var b=a.callback||b,A=a.count||100,d=a.reverse||"false",g=a.channel,f=a.start,j=a.end,h={},i=e();if(!g)return c("Missing Channel");if(!b)return c("Missing Callback");
if(!k)return c("Missing Subscribe Key");h.count=A;h.reverse=d;f&&(h.start=f);j&&(h.end=j);w({callback:i,data:h,success:function(a){b(a)},fail:function(a){c(a)},url:[C,"v2","history","sub-key",k,"channel",z(g)]})},time:function(a){var b=e();w({callback:b,url:[C,"time",b],success:function(b){a(b[0])},fail:function(){a(0)}})},uuid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b},publish:function(a,
b){var b=b||a.callback||function(){},d=a.message,h=a.channel,g=e();if(!d)return c("Missing Message");if(!h)return c("Missing Channel");if(!f)return c("Missing Publish Key");if(!k)return c("Missing Subscribe Key");d=JSON.stringify(d);d=[C,"publish",f,k,0,z(h),g,z(d)];w({callback:g,success:function(a){b(a)},fail:function(){b([0,"Disconnected"])},url:d,data:{uuid:n}})},unsubscribe:function(a){function c(a){a in b&&(b[a].connected=0,b[a].done&&b[a].done(0))}c(a.channel);c(a.channel+"-pnpres");B(a.channel)},
subscribe:function(a,d){function f(){var a=e();b[g].connected&&(b[g].done=w({callback:a,data:{uuid:n},url:[y,"subscribe",l,z(g),a,o],fail:function(){p||(p=1,t(),i());setTimeout(f,G);F.time(function(a){if(a&&p){p=0;q()}else r()})},success:function(a){b[g].connected&&(x||(x=1,s()),p&&(p=0,q()),m=D.set(k+g,o=m&&D.get(l+g)||a[1]),h(a[0],function(b){d(b,a)}),setTimeout(f,10))}}))}function i(){var a={uuid:n},b=e();"0"!=b&&(a.callback=b);w({blocking:1,callback:b,data:a,url:[y,"v2","presence","sub_key",k,
"channel",z(g),"leave"]});return!0}var g=a.channel,d=d||a.callback,l=a.subscribe_key||k,m=a.restore,o=0,r=a.error||function(){},s=a.connect||function(){},q=a.reconnect||function(){},t=a.disconnect||function(){},u=a.presence||function(){},p=0,x=0,y=M(C);if(!L)return T.push([a,d,F]);if(!g)return c("Missing Channel");if(!d)return c("Missing Callback");if(!k)return c("Missing Subscribe Key");g in b||(b[g]={});if(b[g].connected)return c("Already Connected");b[g].connected=1;B=i;j("beforeunload",window,
i);a.presence&&F.subscribe({channel:a.channel+"-pnpres",callback:u,restore:a.restore,disconnect:i});f()},here_now:function(a,b){var b=a.callback||b,d=a.channel,f=e(),g={},h=M(C);if(!d)return c("Missing Channel");if(!b)return c("Missing Callback");if(!k)return c("Missing Subscribe Key");"0"!=f&&(g.callback=f);w({callback:f,data:g,success:function(a){b(a)},fail:function(a){c(a)},url:[h,"v2","presence","sub_key",k,"channel",z(d)]})},xdr:w,ready:K,db:D,each:h,map:u,grep:s,css:o,$:i,create:m,bind:j,supplant:d,
head:t,search:H,attr:l,now:q,unique:p,events:y,updater:x,init:V};n||(n=F.uuid());D.set(k+"uuid",n);return F};PUBNUB=V({publish_key:l(r,"pub-key"),subscribe_key:l(r,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==l(r,"ssl"),origin:l(r,"origin"),uuid:l(r,"uuid")});o(r,{position:"absolute",top:-G});if("opera"in window||l(r,"flash"))r.innerHTML="<object id=pubnubs data=https://dh15atwfs066y.cloudfront.net/pubnub.swf><param name=movie value=https://dh15atwfs066y.cloudfront.net/pubnub.swf><param name=allowscriptaccess value=always></object>";
var U=i("pubnubs")||{};j("load",window,function(){setTimeout(K,0)});PUBNUB.rdx=function(a,b){if(!b)return n[a].onerror();n[a].responseText=unescape(b);n[a].onload()};n.id=G;window.jQuery&&(window.jQuery.PUBNUB=PUBNUB);"undefined"!==typeof module&&(module.exports=PUBNUB)&&K()}();
